<app-next-call-date-set
  *ngIf="isDialog('debtNextCallDate')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-next-call-date-set>

<app-visit-add-dialog
  *ngIf="isDialog('addVisit')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-visit-add-dialog>

<app-sms-delete-dialog
  *ngIf="isDialog('deleteSMS')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-sms-delete-dialog>

<app-payments-cancel-dialog
  *ngIf="isDialog('paymentsCancel')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-payments-cancel-dialog>

<app-payments-confirm-dialog
  *ngIf="isDialog('paymentsConfirm')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-payments-confirm-dialog>

<app-contact-log-dialog
  *ngIf="isDialog('showContactHistory')"
  [actionData]="dialogData"
  (close)="closeDialog()"
></app-contact-log-dialog>

<app-debt-status
  *ngIf="isDialog('debtChangeStatus')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-debt-status>

<app-debt-responsible-set
  *ngIf="isDialog('debtSetResponsible')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-debt-responsible-set>

<app-debt-responsible-clear
  *ngIf="isDialog('debtClearResponsible')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-debt-responsible-clear>

<app-entity-group-add
  *ngIf="isDialog('objectAddToGroup')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-entity-group-add>

<app-promise-confirm-dialog
  *ngIf="isDialog('confirmPromise')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-promise-confirm-dialog>

<app-promise-remove-dialog
  *ngIf="isDialog('deletePromise')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-promise-remove-dialog>

<app-payment-operator-confirm-dialog
  *ngIf="isDialog('confirmPaymentsOperator')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-payment-operator-confirm-dialog>

<app-payment-operator-reject-dialog
  *ngIf="isDialog('rejectPaymentsOperator')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-payment-operator-reject-dialog>

<app-mass-attr-dictionary
  *ngIf="isAttrChangeDictionaryDlg()"
  [actionData]="dialogData"
  [actionName]="dialog"
  (close)="onCloseAction($event)"
>
</app-mass-attr-dictionary>

<app-mass-attr-portfolio
  *ngIf="isDialog('changePortfolioAttr')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
>
</app-mass-attr-portfolio>

<app-mass-attr-timezone
  *ngIf="isDialog('changeTimezoneAttr')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-mass-attr-timezone>

<app-mass-email
  *ngIf="isDialog('emailCreate')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-mass-email>

<app-mass-sms
  *ngIf="isDialog('smsCreate')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-mass-sms>

<app-visit-prepare-dialog
  *ngIf="isDialog('prepareVisit')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-visit-prepare-dialog>

<app-visit-cancel-dialog
  *ngIf="isDialog('cancelVisit')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-visit-cancel-dialog>

<app-operator-details
  *ngIf="isDialog('openUserDetail')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-operator-details>

<app-outsourcing-send
  *ngIf="isDialog('debtOutsourcingSend')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-outsourcing-send>

<app-outsourcing-exclude
  *ngIf="isDialog('debtOutsourcingExclude')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-outsourcing-exclude>

<app-outsourcing-return
  *ngIf="isDialog('debtOutsourcingReturn')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-outsourcing-return>

<app-open-register-contact
  *ngIf="isDialog('registerContact')"
  [actionData]="dialogData"
  (close)="onCloseAction($event)"
></app-open-register-contact>

<!-- TODO(d.maltsev): what is entityTranslationKey? -->
<app-downloader
  #downloader
  entityTranslationKey="entities.actionsLog.gen.plural"
  [name]="metadataKey + '.xlsx'"
  [url]="'/list/excel?name=' + metadataKey"
></app-downloader>

<div class="flex vertical">
  <div class="flex-item">
    <app-titlebar
      *ngIf="titlebar$ | async"
      [titlebar]="titlebar$ | async"
    ></app-titlebar>

    <app-action-grid-filter
      [metadataKey]="metadataKey"
    ></app-action-grid-filter>
  </div>

  <div class="flex-item grow">
    <ng-container
      *ngIf="!isSimple; else simpleGrid"
    >
      <app-grid2
        #grid
        *ngIf="initialized"
        [actions]="gridActions$ | async"
        [columnIds]="columnIds"
        [columns]="columnsDef"
        [fullHeight]="fullHeight"
        [ngClass]="ngClass"
        [persistenceKey]="persistenceKey"
        [rowCount]="rowCount"
        [rowIdKey]="rowIdKey"
        [rows]="rows"
        (action)="onAction($event)"
        (onDblClick)="onDblClick($event)"
        (onFilter)="onRequest()"
        (onPage)="onRequest()"
        (onPageSize)="onRequest()"
        (onSort)="onRequest()"
        (onSelect)="onSelect($event)"
      ></app-grid2>
    </ng-container>

    <ng-template #simpleGrid>
      <app-simple-grid
        #grid
        *ngIf="initialized"
        [actions]="gridActions$ | async"
        [persistenceKey]="persistenceKey"
        [selectionType]="selectionType"
        [columns]="columns"
        [rows]="rows"
        [toolbar]="toolbarItems"
        (action)="onAction($event)"
        (select)="onSelect($event)"
        (dblClick)="onDblClick($event)">
      </app-simple-grid>
    </ng-template>
  </div>
</div>

<ng-container
  *ngIf="currentSelectionAction && selectionActionData"
>
  <span>
    {{ currentSelectionAction | json }}
  </span>
  <br>
  <span>
    {{ selectionActionData | json }}
  </span>
</ng-container>
